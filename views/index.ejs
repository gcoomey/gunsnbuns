

<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
<link rel="stylesheet" href="stylesheets/gtheme.css" />
<link rel="stylesheet" href="stylesheets/jquery.mobile.icons.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/canvasjs/1.7.0/canvasjs.min.js"></script>
<script src="javascripts/index.js"></script>


<!--homepage-->
<div data-role="page" id="homepage">

	<div data-role="header">
		<h1 class = "legend" align="center" ><em>GUNS'N'BUNS</em></h1>
		
	</div><!-- /header -->

	<div role="main" class="ui-content">
		
		<p align="center" div=><strong>WELCOME! </strong><br></br>
		Let's get started
			
		</p>
		        
		Username <input type="text" id="loginUsername" placeholder = "Please enter your email"/> <br>
        Password <input type="text" id="loginPassword" placeholder = "Please enter your password"/> <br>
		    
         <button id="loginbutton" class="ui-btn"> Sign In</button>
		 <div data-role="ui-controlgroup-label">
		 <p><strong>or, if you haven't already</strong></p>
		 </div>  
		 <a href="#register" class="ui-btn">Sign Up!</a>
                
      
	</div><!-- /content -->
</div><!-- /page -->

<!--registration page-->
<div data-role="page" id="register">

	<div data-role="header">
		<h1>Create Account</h1>
		<a href="#homepage" class="ui-btn">Home</a>
		<a href="#login" class="ui-btn">Login</a>
	</div><!-- /header -->

	<div role="main" class="ui-content">
	
	<!--text input boxes-->
	
    Username <input type="text" id="username"/> <br>

    E-mail <input type="email" id="email"/> <br>
    
    Password <input type="text" id="password"/> <br>
	
	Account Type <input type="text" id="acctype"/> <br>

    <button id="submitbutton"> Submit </button>
    
        
	</div><!-- /content -->
</div><!-- /page -->

<script>
// when the 'submit' button is clicked
$( "#submitbutton" ).click(function(event) {
  // stop the default redirect of the browser
  event.preventDefault();
  
  // grab the values input by the user
  var username = $('#username').val();
  var email = $('#email').val();
  var password = $('#password').val();
  var acctype = $('#acctype').val();
  
  var isValid = true;
  
  if(username == ""){
     alert("Please enter a username");
     isValid = false;
  }
  if(!email.includes("@")){
     alert("Please enter a valid email");
     isValid = false;
  }

 // only send the data to the database, if the parameter is true.
  if(isValid == true){
      // send the data to the server side
      $.post( "/putInDatabase", { username:username, email:email, password:password, acctype:acctype })
      .done(function( data ) {
        alert( "Data Loaded: " + data );
      });
  }
  
  
  
});

</script>


<!--Login Page-->
<div data-role="page" id="login" >

	<div data-role="header">
		<h1>Log in to your account</h1>
		<a href="#homepage" class="ui-btn">Home</a>
		</div><!-- /header -->

	<div role="main" class="ui-content">
		                
        Username <input type="text" id="loginUsername"/> <br>
        Password <input type="text" id="loginPassword"/> <br>

        
         <button id="loginbutton"> Login </button>
         
 </div><!-- /content -->       
 </div><!-- /page -->       

<script>
// when the 'Login' button is clicked
$( "#loginbutton" ).click(function(event) {
  // stop the default redirect of the browser
  event.preventDefault();
  
  // takes the values input by the user
  var un = $('#loginUsername').val();
  var pw = $('#loginPassword').val();
  
  if(un == "")
  {
	alert ("Please enter a username");
  }
   if(pw == ""){
	alert ("Please enter a password");
  }


	
  $.post( "/checkTheLogin", { username: un, password: pw })
      .done(function( data ) {
	  //say what account type is
        alert( "Data Loaded: " + data );
		
		
		
		if(data.includes("customer")){
		
	// move to the customer dashboard
	   window.location = "/#customerdash";
		}
	else if(data.includes("driver")){
		
		 // make a call to the server side to get the data
            $.get( "/getDriverData", function( data ) {
            // display the data on the driver page
                $( "#driverOutput" ).html( data );
	});
		
	// move to the driver dashboard
	   window.location = "/#driver";
	}
	
	        else if(data.includes("manager")){
                
           // make a call to the serverside to get the data!
            $.get( "/getManagerData", function( data ) {
            // output the data to the manager page
                $( "#managerOutput" ).html( data );
				
				          
            });
             
			        
           // move to the manager dashboard
           window.location="/#manager";
        }
        
        
      });
  
  
 }); 
  
</script>

<script>
var myCart = [];

</script>

<!--Customer Dashboard with add to cart-->
<div data-role="page" id="customerdash">
	
	
	
	<div data-role="header">
		<h1>Choose your delicious doughnuts</h1>
		<a href="#homepage" class="ui-btn">Home</a>
	</div><!-- /header -->

	<div role="main" class="ui-content">
		<p>Choose from our delicious range of homemade doughnuts, all lovingly prepared in our on site bakery</p>
        
           <div id="productdata"> </div>
       
         <script>
        $.get( "/getProducts", function( data ) {
              
              $("#productdata").html(data);
        });
        </script>    

     
	<button id="goToCheckout"> Checkout </button>
	
        
	</div><!-- /content -->
 </div><!-- /page --> 

<!--Allow customer to review order-->
<div data-role="page" id="checkoutreview" >

	<div data-role="header">
		<h1>Review your order</h1>
		<a href="#homepage" class="ui-btn">Home</a>
	</div><!-- /header -->

	<div role="main" class="ui-content">
		<p>Check your order before continuing to the payment page</p>
        
		<div id="products">
		</div>
        
         <button id="insertintodb">Go to Cart</button>
         
         
        
	</div><!-- /content -->
 </div><!-- /page --> 
 
<script>

$("#insertintodb").click(function() {
		
		//get the customer username
		var orderby = $('#loginUsername').val();
	
		
		//get the list of products from cart
		var items = myCart.toString();
		 
 
      $.post( "/completeCheckout", { orderby: orderby, items: items })
      .done(function( data ) {
        alert( "Data Loaded: " + data );
      });


});

</script>
 
<script>
//this function triggers each time a page is loaded, for sessions
$(document).on("pagecreate",function(event){

$.get("/checkIfTimeLeft",function( data ) {
	
		if(data.includes("ok")){
		} else {
		
		//session expired
		window.location="/";
		}
	});
	
});



$( "#goToCheckout" ).click(function() {

        // update the div tag with the shopping cart
        
        var cartItems = myCart.toString().split(',');
		
        // wipe the 'products' div tag
        $('#products').html('');
		
		var total = 0;
		
			
        // for each record, append them to the 'products' div.
        for(var i=0; i< cartItems.length; i++){
		
		var singleRecord = cartItems[i].split('-');
		//qty ordered by cost of item
		var itemTotal = singleRecord[1] * singleRecord[2]; 
		total = total + itemTotal;
            
            $('#products').append(cartItems[i] + '<br>');
        }
        
       $('#products').append("Total cost of order: "+total);
        // move to to the checkout review
        window.location="/#checkoutreview";
});


function addToCart(itemName,cost){
    // finding out the name of the item (product) we are adding
    var item = itemName;
	console.log(item);
    
    // get the quantity
	var qty = $('#'+item).children("option:selected").val();
	console.log(qty);
    
    // search the cart and remove item if added before
	
    console.log("Searching to see if record already exists");
    myCart.forEach(function(itemCurrent, index, array) {
           
                 
           if(itemCurrent.includes(item,cost)){
              console.log("Removing previous reference to " + itemName);
                var indexx = array.indexOf(itemCurrent);
                if (indexx !== -1) {
                  array.splice(indexx, 1);
                }
           }
    });
    
    
    // add the item to the cart
    myCart.push(item + '-' + qty + '- â‚¬'+ cost);
    
    alert(myCart);


	
	//put in the session
	$.post("/putInSession", {cart:myCart} );

}
</script>
<!--Manager Page-->
<div data-role="page" id="manager">

	<div data-role="header">
		<h1>Reports</h1>
		<a href="#homepage" class="ui-btn">Home</a>
	</div><!-- /header -->

	<div role="main" class="ui-content">
		<p>Recent customer orders</p>
         
     <div id ="managerOutput"> 

	</div>
	
	<script>
	$.get("/getManagerData", function( data ) {
	$('#managerOutput').html(data);
	});
	</script>
	
			<select id="getOrderByRange">
			<option value = "7"> 7 days </option>
			<option value = "30"> 30 days </option>
			</select>
			<button onclick="getRangeData()"> Get Range Data </button>
			
			<div id="rangeData">
			</div>
			
			<script>
			function getRangeData(){
			
			var range = $('#getOrderByRange').children("option:selected").val();
			
			$.post( "/getRangeData", { range: range} )
              .done(function( data ) {
                $('#rangeData').html(data);
              });
			
			}
			
			
			
			</script>
			
	</div><!-- /content -->
 </div><!-- /page --> 
 
<!--Driver Page-->
<div data-role="page" id="driver">

	<div data-role="header">
		<h1>Driver Dashboard</h1>
		<a href="#homepage" class="ui-btn">Home</a>
	</div><!-- /header -->
    <script
  
  src="https://code.jquery.com/jquery-3.6.0.js"
  integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
  crossorigin="anonymous">
  </script>
<span>Your current location is the city of <span><div id="location"></div></span> The current temperature is <span><div id="currentTemp"></div></span>
 <script>


$.getJSON( "http://api.weatherstack.com/current?access_key=e01f81992b8fa49e7fb20914c3b2d8db&query=Cork", function( json ) {
  console.log("JSON Data: " +json.current.temperature +json.location.name); 
  
  $('#currentTemp').html(json.current.temperature);
  $('#location').html (json.location.name);
  
 });
</script>

	<div role="main" class="ui-content">
		<h2><p>Orders for Delivery</p></h2>
         
     <div id ="driverOutput"> 

	</div>	
</div><!-- /content -->
</div><!-- /page --> 
 
 <script>


$.getJSON( "http://api.weatherstack.com/current?access_key=e01f81992b8fa49e7fb20914c3b2d8db&query=Cork", function( json ) {
  console.log("JSON Data: " +json.current.temperature +json.location.name); 
  
  $('#currentTemp').html(json.current.temperature);
  $('#location').html (json.location.name);
  
 });
</script>
       
        

<script>
function markAsDelivered(id){

    
    
    $.post( "/updateOrderStatus", { id: id })
  .done(function( data ) {
    alert( "Data Loaded: " + data );
  });
    
}


function deleteOrder(id){

    
    
    $.post( "/deleteOrder", { id: id })
  .done(function( data ) {
    alert( "Data Loaded: " + data );
	
   location.reload();
    
  });
    
}

</script>

</div><!-- /content -->
</div><!-- /page --> 
 

